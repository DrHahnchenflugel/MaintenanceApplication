{% extends "base.html" %}
{% block title %} Maintenance - Dashboard {% endblock %}
{% block page_title %} Dashboard {% endblock %}

{% block content %}
    <div class="row">
        <div class="card" style="flex:1">
            <div>Open Issues</div>
            <div class="kpi">{{ issue_info.get('num_open_issues') }}</div>
        </div>


        <div class="card" style="flex:1">
            <div>Oldest Open Issue</div>
            <div class="kpi">{{ issue_info.get('oldest_issue') }}</div>
        </div>

        <div class="card" style="flex:1">
            <div>Blocked Issues</div>
            <div class="kpi">{{ issue_info.get('num_blocked_issues') }}</div>
        </div>

        <div class="card" style="flex:2; min-height:160px">
            <div>Open Issues (trend) </div>
            <div style="height:120px; border:1px dashed var(--line); border-radius:8px; margin-top:8px;">
                <canvas id="issuesTrendChart"></canvas>
                <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
                <script>
                fetch("{{ url_for('app.issues_trend') }}")
                  .then(res => res.json())
                  .then(data => {
                    const labels = data.map(r => r.week_start);
                    const values = data.map(r => r.active_issues);

                    new Chart(document.getElementById("issuesTrendChart"), {
                      type: "line",
                      data: {
                        labels: labels,
                        datasets: [{
                          label: "Active Issues",
                          data: values,
                          borderColor: "#FF6600",
                          backgroundColor: "rgba(255, 102, 0, 0.2)",
                          fill: true,
                          tension: 0.3
                        }]
                      },
                      options: {
                        scales: {
                          x: { title: { display: true, text: "Week" }},
                          y: { title: { display: true, text: "Active Issues" }, beginAtZero: true }
                        }
                      }
                    });
                  });
                </script>
            </div>
        </div>
    </div>

    <div class="card" style="margin-top:16px;">
        <h3 style="margin:0 0 8px 0;"> Assets (summary)</h3>
        <div>-</div>
    </div>
{% endblock %}

{% block footer_center_right %}
    <a class="btn btn--lg btn--fixed--bottomright" href="{{ url_for('app.new_issue') }}">New Issue +</a>
{% endblock %}