{% extends "base.html" %}
{% block title %}Maintenance â€“ Asset{% endblock %}
{% block page_title %}Asset{% endblock %}

{% block page_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/asset.css') }}">
{% endblock %}

{% block content %}
<div class="asset-page">
  <section class="card asset-hero">
    <div>
      <h2 class="asset-hero__title">{{ asset.asset_tag or 'Unknown Asset' }}</h2>
      <p class="asset-hero__subtitle">
        {{ asset.make_label or asset.make_name or '-' }} {{ asset.model_label or asset.model_name or '-' }}
      </p>
    </div>
    <span class="asset-pill">{{ asset.status_label or asset.status_code or 'UNKNOWN' }}</span>
  </section>

  <section class="card asset-main-panel">
    <div class="asset-details">
      <h3>Asset Details</h3>

      <div class="asset-grid">
        <div class="asset-col">
          <div class="asset-row"><span>Serial</span><strong>{{ asset.serial_number or '-' }}</strong></div>
          <div class="asset-row"><span>Category</span><strong>{{ asset.category_label or asset.category_name or '-' }}</strong></div>
          <div class="asset-row">
            <span>Purchased</span>
            <strong>
              {% set purchased_time, purchased_date = asset.acquired_at | format_dt %}
              {{ purchased_date if purchased_date else '-' }}
            </strong>
          </div>
          <div class="asset-row"><span>Site</span><strong>{{ asset.site_shorthand or '-' }}</strong></div>
          <div class="asset-row"><span>Location</span><strong>{{ asset.site_fullname or '-' }}</strong></div>

          <div class="asset-actions">
            <a class="btn btn--ok" href="{{ url_for('app.new_issue_form', asset_id=asset.asset_id) }}">+ New Issue</a>
            <a class="btn asset-back" href="{{ url_for('app.assets_index') }}">Back to list</a>
          </div>
        </div>

        <div class="asset-col">
          <div class="asset-row"><span>Age</span><strong>{{ asset_age }}</strong></div>
          <div class="asset-row"><span>Retired</span><strong>{{ 'Yes' if asset.retired_at else 'No' }}</strong></div>
          <div class="asset-row"><span>Status</span><strong>{{ asset.status_code or '-' }}</strong></div>
          <div class="asset-row"><span>Model</span><strong>{{ asset.model_label or asset.model_name or '-' }}</strong></div>
          <div class="asset-row"><span>Variant</span><strong>{{ asset.variant_label or asset.variant_name or '-' }}</strong></div>
        </div>
      </div>
    </div>

    <div class="asset-history">
      <h3>Past Actions</h3>

      {% if past_actions %}
        {% for action in past_actions %}
          <article class="history-item">
            <div class="history-date">
              {% set action_time, action_date = action.created_at | format_dt %}
              {{ action_date }}
            </div>
            <div class="history-title">{{ action.status.label }}</div>
            <div class="history-body">
              {{ action.title }}
              {% if action.reported_by %}<br><span class="history-user">{{ action.reported_by }}</span>{% endif %}
            </div>
          </article>
        {% endfor %}
      {% else %}
        <p class="history-empty">No past actions for this asset yet.</p>
      {% endif %}
    </div>
  </section>
</div>
{% endblock %}
