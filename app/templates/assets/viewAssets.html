{% extends "base.html" %}
{% block title %}Maintenance â€“ Assets{% endblock %}
{% block page_title %}Assets{% endblock %}

{% block page_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/list_issues.css') }}">
{% endblock %}

{% block content %}
<div class="issues-wrap">
  <form method="get" class="issues-toolbar">

    <div class="issues-toolbar__row">

      <label class="issues-field">
        <span class="issues-label">Retired</span>
        <select class="issues-select" name="retired" onchange="this.form.submit()">
          <option value="active" {{ 'selected' if cur_retired_mode == 'active' else '' }}>Active only</option>
          <option value="all" {{ 'selected' if cur_retired_mode == 'all' else '' }}>All</option>
          <option value="retired" {{ 'selected' if cur_retired_mode == 'retired' else '' }}>Retired only</option>
        </select>
      </label>

      <label class="issues-field">
        <span class="issues-label">Status</span>
        <select class="issues-select" name="status_id" onchange="this.form.submit()">
          <option value="" {{ 'selected' if not cur_status_id }}>All</option>
          {% for st in status_options %}
            <option value="{{ st.id }}" {{ 'selected' if cur_status_id == st.id else '' }}>
              {{ st.label }}
            </option>
          {% endfor %}
        </select>
      </label>

      <label class="issues-field">
        <span class="issues-label">Site</span>
        <select class="issues-select" name="site_id" onchange="this.form.submit()">
          <option value="" {{ 'selected' if not cur_site_id }}>All</option>
          {% for s in sites %}
            <option value="{{ s.id }}" {{ 'selected' if cur_site_id == s.id else '' }}>
              {{ s.fullname }} ({{ s.shorthand }})
            </option>
          {% endfor %}
        </select>
      </label>

      <label class="issues-field">
        <span class="issues-label">Category</span>
        <select class="issues-select" name="category_id" onchange="this.form.submit()">
          <option value="" {{ 'selected' if not cur_category_id }}>All</option>
          {% for c in categories %}
            <option value="{{ c.id }}" {{ 'selected' if cur_category_id == c.id else '' }}>
              {{ c.label }}
            </option>
          {% endfor %}
        </select>
      </label>

      <label class="issues-field">
        <span class="issues-label">Make</span>
        <select class="issues-select" name="make_id" onchange="this.form.submit()" {{ 'disabled' if not cur_category_id }}>
          <option value="" {{ 'selected' if not cur_make_id }}>All</option>
          {% for m in makes %}
            <option value="{{ m.id }}" {{ 'selected' if cur_make_id == m.id else '' }}>
              {{ m.label }}
            </option>
          {% endfor %}
        </select>
      </label>

      <label class="issues-field">
        <span class="issues-label">Model</span>
        <select class="issues-select" name="model_id" onchange="this.form.submit()" {{ 'disabled' if not cur_make_id }}>
          <option value="" {{ 'selected' if not cur_model_id }}>All</option>
          {% for mo in models %}
            <option value="{{ mo.id }}" {{ 'selected' if cur_model_id == mo.id else '' }}>
              {{ mo.label }}
            </option>
          {% endfor %}
        </select>
      </label>

      <label class="issues-field">
        <span class="issues-label">Variant</span>
        <select class="issues-select" name="variant_id" onchange="this.form.submit()" {{ 'disabled' if not cur_model_id }}>
          <option value="" {{ 'selected' if not cur_variant_id }}>All</option>
          {% for v in variants %}
            <option value="{{ v.id }}" {{ 'selected' if cur_variant_id == v.id else '' }}>
              {{ v.label }}
            </option>
          {% endfor %}
        </select>
      </label>

      <label class="issues-field issues-field--grow">
        <span class="issues-label">Asset Tag</span>
        <input class="issues-input" type="text" name="asset_tag" value="{{ cur_asset_tag }}"
              placeholder="Exact asset tag">
      </label>

      <div class="issues-actions">
        <button class="btn issues-apply" type="submit">Apply</button>
        <a class="btn btn-secondary" href="{{ url_for('app.assets_index') }}">Clear</a>
      </div>

    </div>
  </form>

  {% if assets %}
    <div class="table">
      <div class="table-head table-head--4">
        <div>Asset</div>
        <div>Classification</div>
        <div>Acquired</div>
        <div>Status</div>
      </div>

      <div class="table-scroll">
        {% for asset in assets %}
          <div class="table-row table-row--4">

            <div class="issue-asset">
              {{ asset.asset_tag }} <br>
              <div class="issue-sub">Serial: {{ asset.serial_number or '-' }}</div>
            </div>

            <div class="issue-cell-title">
              <div class="issue-title">
                {{ (sites | selectattr('id', 'equalto', asset.site_id) | map(attribute='fullname') | first) or '-' }}
              </div>
              <div class="issue-sub">
                Category: {{ (categories | selectattr('id', 'equalto', asset.category_id) | map(attribute='label') | first) or '-' }}
              </div>
            </div>

            <div>
              {% set time, date = asset.acquired_at | format_dt %}
              <div>
                {{ date if date else '-' }}<br>
                <span class="time">{{ time if time else '' }}</span>
              </div>
            </div>

            <div>
              <span class="issue-status status-unknown">
                {{ (status_options | selectattr('id', 'equalto', asset.status_id) | map(attribute='label') | first) or '-' }}
              </span>
            </div>

          </a>
        {% endfor %}
      </div>
    </div>
  {% else %}
    <p style="margin-top:16px;">No assets match this filter.</p>
  {% endif %}
</div>
{% endblock %}
