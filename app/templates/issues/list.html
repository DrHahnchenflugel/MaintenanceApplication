{% extends "base.html" %}
{% block title %}Maintenance â€“ Issues{% endblock %}
{% block page_title %}Issues{% endblock %}

{% block page_css %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/pages/list_issues.css') }}">
{% endblock %}

{% block content %}

  <form method="get" class="issues-toolbar">
    <div class="issues-toolbar__row">

      <label class="issues-field">
        <span class="issues-label">Status</span>
        <select class="issues-select" name="status" onchange="this.form.submit()">
          <option value="" {{ 'selected' if not cur_status }}>All</option>
          {% for st in status_options %}
            <option value="{{ st.code }}" {{ 'selected' if cur_status == st.code else '' }}>
              {{ st.label }}
            </option>
          {% endfor %}
        </select>
      </label>

      <label class="issues-field issues-field--grow">
        <span class="issues-label">Search</span>
        <input class="issues-input" type="text" name="q" value="{{ search }}"
               placeholder="Title or description">
      </label>

      <div class="issues-actions">
        <button class="btn issues-apply" type="submit">Apply</button>
      </div>

    </div>
  </form>

  {% if issues %}
    <div class="table">
      <div class="table-head table-head--4">
        <div>Asset</div>
        <div>Title</div>
        <div>Opened</div>
        <div>Status</div>
      </div>

      {% for issue in issues %}
        <a class="table-row table-row--4"
           href="{{ url_for('app.view_issue', issue_id=issue.id) }}">

          <div class="issue-asset">
            #{{ issue.asset.asset_tag }}
            {% if issue.asset.site_id %}
              <span class="muted">({{ issue.asset.site_id }})</span>
            {% endif %}
          </div>

          <div class="issue-cell-title">
            <div class="issue-title">{{ issue.title }}</div>
            {% if issue.reported_by %}
              <div class="issue-sub">Reported by {{ issue.reported_by }}</div>
            {% endif %}
          </div>

          <div>
            {{ issue.created_at }}
            {% if issue.last_action_at %}
              <div class="time">(last: {{ issue.last_action_at }})</div>
            {% endif %}
          </div>

          {% set code = issue.status.code %}
          <div>
            <span class="issue-status {{
              'status-open' if code == 'OPEN'
              else 'status-in-progress' if code == 'IN_PROGRESS'
              else 'status-blocked' if code == 'BLOCKED'
              else 'status-closed' if code == 'CLOSED'
              else 'status-unknown'
            }}">
              {{ issue.status.label }}
            </span>
          </div>

        </a>
      {% endfor %}
    </div>
  {% else %}
    <p style="margin-top:16px;">No issues match this filter.</p>
  {% endif %}

{% endblock %}
